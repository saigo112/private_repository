<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ãƒ†ãƒˆãƒªã‚¹Webã‚²ãƒ¼ãƒ </title>
    
    <!-- PWAå¯¾å¿œ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Tetris">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    
    <link rel="stylesheet" href="style.css?v=3.0">
</head>
<body>
    <!-- OPç”»é¢ -->
    <div id="opScreen" class="op-screen">
        <div class="op-content">
            <div class="op-title">
                <h1 class="op-main-title">TETRIS</h1>
                <div class="op-subtitle">Web Edition</div>
                <div class="score-displays">
                    <div class="personal-best-display">
                        <span class="score-label">å€‹äººãƒ™ã‚¹ãƒˆ:</span>
                        <span id="personalBest" class="score-value personal">0</span>
                    </div>
                    <div class="world-record-display">
                        <span class="score-label">ä¸–ç•Œè¨˜éŒ²:</span>
                        <span id="worldRecord" class="score-value world">0</span>
                    </div>
                </div>
            </div>
            

            
            <div class="op-instructions">
                <h3>æ“ä½œæ–¹æ³•</h3>
                <div class="instructions-grid">
                    <div class="instruction-item">
                        <span class="key">â†â†’</span>
                        <span class="action">ç§»å‹•</span>
                    </div>
                    <div class="instruction-item">
                        <span class="key">â†‘</span>
                        <span class="action">å›è»¢</span>
                    </div>
                    <div class="instruction-item">
                        <span class="key">â†“</span>
                        <span class="action">è½ä¸‹</span>
                    </div>
                    <div class="instruction-item">
                        <span class="key">Space</span>
                        <span class="action">ãƒ‰ãƒ­ãƒƒãƒ—</span>
                    </div>
                </div>
            </div>
            
            <div class="difficulty-section">
                <h3>é›£æ˜“åº¦ã‚’é¸æŠ</h3>
                <div class="difficulty-options">
                    <button class="difficulty-btn" data-speed="0.5">
                        ğŸ˜Š ã‹ã‚“ãŸã‚“<br><span class="speed-label">0.5å€é€Ÿ</span>
                    </button>
                    <button class="difficulty-btn selected" data-speed="1.0">
                        ğŸ™‚ ãµã¤ã†<br><span class="speed-label">1.0å€é€Ÿ</span>
                    </button>
                    <button class="difficulty-btn" data-speed="1.5">
                        ğŸ˜¤ ã‚€ãšã‹ã—ã„<br><span class="speed-label">1.5å€é€Ÿ</span>
                    </button>
                </div>
            </div>
            
            <button id="startGameBtn" class="start-game-btn">
                <span class="btn-text">ã‚²ãƒ¼ãƒ é–‹å§‹</span>
                <span class="btn-icon">â–¶ï¸</span>
            </button>
            
            <div class="op-footer">
                <p>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</p>
            </div>
        </div>
    </div>

    <script src="script.js?v=4.0"></script>

    <!-- PWA: ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ç™»éŒ² -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(function(registration) {
                        console.log('Service Workerç™»éŒ²æˆåŠŸ:', registration.scope);
                        
                        // ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('æ–°ã—ã„Service WorkerãŒåˆ©ç”¨å¯èƒ½ã§ã™');
                                    // å¿…è¦ã«å¿œã˜ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ›´æ–°ã‚’é€šçŸ¥
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('Service Workerç™»éŒ²å¤±æ•—:', error);
                    });
            });
        }

        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™');
            e.preventDefault();
            deferredPrompt = e;
            
            // å¿…è¦ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            // showInstallButton();
        });

        window.addEventListener('appinstalled', function(e) {
            console.log('PWAãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸ');
            deferredPrompt = null;
        });
    </script>
</body>
</html>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen" class="game-container hidden">
        <div class="game-header">
            <h1 class="game-title">ãƒ†ãƒˆãƒªã‚¹</h1>
            <div class="game-info">
                <div class="info-item">
                    <span class="label">ã‚¹ã‚³ã‚¢:</span>
                    <span id="score">0</span>
                </div>
                <div class="info-item">
                    <span class="label">ãƒ¬ãƒ™ãƒ«:</span>
                    <span id="level">1</span>
                </div>
                <div class="info-item">
                    <span class="label">ãƒ©ã‚¤ãƒ³:</span>
                    <span id="lines">0</span>
                </div>
                <div class="info-item">
                    <span class="label">çˆ†å¼¾:</span>
                    <span id="bombs">0</span>
                </div>
                <div class="info-item">
                    <span class="label">é€Ÿåº¦:</span>
                    <span id="speed">1.0x</span>
                </div>
            </div>
                                    <div class="next-piece-container">
                            <span class="label">æ¬¡:</span>
                            <canvas id="nextPiece" width="60" height="40"></canvas>
                        </div>
        </div>

        <div class="game-main">
            <div class="game-board-container">
                <canvas id="gameBoard" width="300" height="600"></canvas>
                <div id="gameOver" class="game-over hidden">
                    <h2>ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h2>
                    <button id="restartBtn" class="btn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                </div>
            </div>

            <div class="game-sidebar">
                <div class="next-piece-container">
                    <h3>æ¬¡ã®ãƒ”ãƒ¼ã‚¹</h3>
                    <canvas id="nextPiece" width="120" height="80"></canvas>
                </div>
                
                <div class="controls-info">
                    <h3>æ“ä½œæ–¹æ³•</h3>
                    <div class="pc-controls">
                        <p>â†â†’: ç§»å‹•</p>
                        <p>â†‘: å›è»¢</p>
                        <p>â†“: è½ä¸‹</p>
                        <p>Space: ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—</p>
                        <p>B: çˆ†å¼¾ãƒ”ãƒ¼ã‚¹ç”Ÿæˆ</p>
                        <p>P: ãƒãƒ¼ã‚º</p>
                        <p>+/-: é€Ÿåº¦èª¿æ•´</p>
                    </div>
                    <div class="mobile-controls-info">
                        <p>ğŸ“± ã‚¹ãƒãƒ›æ“ä½œ:</p>
                        <p>ãƒ‰ãƒ©ãƒƒã‚°: ç§»å‹•ãƒ»å›è»¢</p>
                        <p>ãƒœã‚¿ãƒ³: å„ç¨®æ“ä½œ</p>
                        <p>ã‚¿ãƒƒãƒ—: çˆ†å¼¾é…ç½®</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mobile-controls">
            <div class="control-row">
                <button id="leftBtn" class="control-btn">â†</button>
                <button id="upBtn" class="control-btn">â—»</button>
                <button id="rightBtn" class="control-btn">â†’</button>
            </div>
            <div class="control-row">
                <button id="bombBtn" class="control-btn bomb-btn">çˆ†å¼¾</button>
                <button id="downBtn" class="control-btn">â†“</button>
                <button id="pauseBtn" class="control-btn pause-btn">â¸ï¸</button>
            </div>
        </div>
    </div> 